#!/usr/bin/env python
###
# XEN CLEAN INSTALLER
# Main script
#
# written by Andrew Peace
# Copyright XenSource Inc. 2006

# user-interface stuff:
import tui
import generalui
import pyanswerfile_ui
import uicontroller

# backend
import backend

# general
import sys
from getopt import getopt

ui_package = tui

def main():
    global ui_package
    
    try:
        (opts, args) = getopt(sys.argv[1:],
                              "",
                              ["pyanswerfile="])
    except Exception, e:
        print "This program takes no arguments."
        sys.exit(1)

    for (opt, val) in opts:
        if opt == "--pyanswerfile":
            pyanswerfile_ui.specifySubUI(ui_package)
            pyanswerfile_ui.specifyAnswerFile(val)
            ui_package = pyanswerfile_ui
            
    results = { 'ui-package': ui_package }
    
    ui_package.init_ui(results)

    seq = [ ui_package.welcome_screen,
            generalui.disk_selection ]
    uicontroller.runUISequence(seq, results)

    backend.performStage1Install(results)

    seq = [ ui_package.get_root_password,
            ui_package.determine_basic_network_config,
            ui_package.need_manual_hostname ]
    uicontroller.runUISequence(seq, results)
    backend.performStage2Install(results)
    
    seq = [ ui_package.installation_complete ]
    uicontroller.runUISequence(seq, results)
    
    ui_package.end_ui()


if __name__ == "__main__":
    main()
