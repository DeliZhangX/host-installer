#!/bin/bash
#
# Firmware loader agent
# based on the one in Debian Etch

set -e

FIRMWARE_DIRS="/usr/share/firmware /usr/share/user-firmware /lib/firmware"

if [ ! -e /sys/${DEVPATH}/loading ]; then
    echo "/sys/${DEVPATH}/ does not exist" >>/tmp/firmware-log
    exit 1
fi

for DIR in ${FIRMWARE_DIRS} ; do
   [ -e "${DIR}/${FIRMWARE}" ] || continue
   echo 1 > /sys/${DEVPATH}/loading
   cat "${DIR}/${FIRMWARE}" > /sys/${DEVPATH}/data
   echo 0 > /sys/${DEVPATH}/loading
   exit 0
done

# firmware not found:
echo "${FIRMWARE} firmware image was not found in ${FIRMWARE_DIRS}" >>/tmp/firmware-log
exit 1

